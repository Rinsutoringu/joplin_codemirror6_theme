# Internationalization (i18n) Guide

This plugin supports multiple languages following the Joplin i18n specification.

## Supported Languages

| Locale Code | Language | Status |
|------------|----------|--------|
| `en` | English | âœ… Supported |
| `zh_CN` | Chinese (Simplified) | âœ… Supported |

## Directory Structure

```
locales/
â”œâ”€â”€ en.json       # English translations
â””â”€â”€ zh_CN.json    # Chinese (Simplified) translations
src/
â””â”€â”€ i18n.ts       # i18n helper module
```

## Translation Format (Joplin Specification)

The plugin follows Joplin's i18n specification with the following structure:

- **Settings**: `settings.SETTING_NAME.label` and `settings.SETTING_NAME.description`
- **Commands**: Top-level keys using camelCase (e.g., `openTableDialog`)
- **Context Menu**: Top-level keys (e.g., `tableEditingToolsContextMenu`)

### Example Structure

```json
{
  "settings": {
    "section": "CodeMirror 6 Theme",
    "enableInlineCode": {
      "label": "Enable inline code styling",
      "description": "Add background color and special color to inline code"
    }
  },
  "openTableDialog": "Table Editing Tools",
  "tableEditingToolsContextMenu": "ðŸ“‹ Table Editing Tools..."
}
```

## Usage in Code

### Importing i18n

```typescript
import { initI18n, t } from './i18n';
```

### Initializing i18n

In the plugin's `onStart` function:

```typescript
export async function onStart() {
  await initI18n();
  // Now i18n is ready to use
}
```

### Getting Translated Strings

```typescript
// Simple key
const label = t('openTableDialog');

// Nested keys with dot notation
const settingLabel = t('settings.enableInlineCode.label');

// With fallback value
const text = t('someKey', 'Default text');
```

## How It Works

1. **Initialization**: `initI18n()` detects the Joplin application locale
2. **Locale Detection**: Uses `joplin.settings.globalValue('locale')`
3. **Locale Normalization**: Converts locale codes (e.g., `zh-CN` â†’ `zh_CN`)
4. **Translation Loading**: Loads the corresponding JSON file from `locales/`
5. **Fallback**: Falls back to English if the locale is not available

## Adding a New Language

To add support for a new language:

1. Create a new JSON file in the `locales/` directory (e.g., `locales/es.json` for Spanish)
2. Use the same structure as the existing locale files
3. Translate all strings to the new language
4. Update the `localeMap` in `src/i18n.ts`:

```typescript
const esTranslations = require('../locales/es.json');

const localeMap: { [key: string]: any } = {
  'en': enTranslations,
  'zh_CN': zhCNTranslations,
  'es': esTranslations,  // Add this line
};
```

5. Build the plugin - no other code changes needed

## Translation Keys Reference

### Settings Keys

```
settings.section                          - Settings section title
settings.enableInlineCode.label           - Inline code styling toggle label
settings.enableInlineCode.description     - Inline code styling description
settings.enableLinkColor.label            - Link color toggle label
settings.enableLinkColor.description      - Link color description
settings.enableGitHubAlerts.label         - GitHub Alerts toggle label
settings.enableGitHubAlerts.description   - GitHub Alerts description
settings.enableHeadingStyles.label        - Heading styles toggle label
settings.enableHeadingStyles.description  - Heading styles description
settings.enableBlockquoteStyles.label     - Blockquote styles toggle label
settings.enableBlockquoteStyles.description - Blockquote styles description
settings.enableTableRendering.label       - Table rendering toggle label
settings.enableTableRendering.description - Table rendering description
settings.inlineCodeColor.label            - Inline code color setting label
settings.inlineCodeColor.description      - Inline code color description
settings.linkColor.label                  - Link color setting label
settings.linkColor.description            - Link color description
```

### Command Keys

```
openTableDialog            - Table Editing Tools command
tableFormatTable          - Format table command
tableAddRowAbove          - Add row above command
tableAddRowBelow          - Add row below command
tableDeleteRow            - Delete row command
tableAddColumnLeft        - Add column left command
tableAddColumnRight       - Add column right command
tableDeleteColumn         - Delete column command
tableAlignLeft            - Align left command
tableAlignCenter          - Align center command
tableAlignRight           - Align right command
tableAlignClear           - Clear alignment command
toggleInlineMath          - Toggle inline math command
```

### Context Menu Keys

```
tableEditingToolsContextMenu  - Table editing tools context menu item
```

## Build Process

The webpack configuration copies all locale files from `locales/` to `dist/locales/` during the build:

```javascript
{
    from: '**/*',
    context: path.resolve(__dirname, 'locales'),
    to: path.resolve(__dirname, 'dist', 'locales'),
}
```

## Testing i18n

To test i18n functionality:

1. Change your Joplin application language to the language you want to test
2. Restart Joplin or reload the plugin
3. Check if all UI elements (settings, commands, menus) appear in the correct language

## Joplin Specification Compliance

This plugin follows Joplin's official i18n specification:

- âœ… Settings use nested structure: `settings.SETTING_NAME.{label, description}`
- âœ… Commands use flat top-level keys: `commandName`
- âœ… Locale codes follow standard format: `en`, `zh_CN`
- âœ… Automatic locale detection based on system language
- âœ… Graceful fallback to English for unsupported locales

## Notes

- JSON locale files must be valid UTF-8 encoded
- All keys are case-sensitive
- Missing translations default to the key itself
- Unsupported locales automatically fall back to English

